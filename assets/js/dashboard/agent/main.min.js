const vuetify=new Vuetify(vuetify_opts),api_url=ra_elite_usa_insurance_ajaxurl;Vue.component("downloadExcel",JsonExcel);let vm=new Vue({vuetify:vuetify,el:"#ra-elite-usa-insurance-container",data:{selectedItem:0,barAlert:!1,barTimeout:6e3,percent_loading_active:!1,percent_loading:!1,pdf_loading:!1,logout_loading:!1,barMessage:"",quote_id:url_params.get("quotation_id"),notifications_loading:!1,quote_loading:!1,table_loading:!1,requests_table_loading:!1,attachments_table_loading:!1,manager_attachments_table_loading:!1,information_requests_table_loading:!1,information_requests_loading:!1,attachment_loading:!1,view_dialog:!1,edit_dialog:!1,alert:!1,alert_type:"",alert_message:"",request_edit_form_valid:!1,routes:routes,notifications:[],rules:{required:[e=>!!e||"This field is required"]},quotes:{modification_content:"",search:"",excel:{header:{"Full Name":{field:"personal_information",callback:e=>`${e.first_name} ${e.middle_name} ${e.last_name}`},Birthdate:{field:"personal_information",callback:e=>moment(e.birthdate).format("MM/DD/YYYY")},Telephone:{field:"personal_information.telephone",callback:e=>`Tel:${e}`},Email:{field:"personal_information.email"},"Company / Plan":{field:"affordable_care_act.company_plan"},Income:{field:"personal_information.total_income",callback(e){let t=e;if(typeof t!==String){var a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),i=a.format(t);return"$NaN"==i||NaN===i?t:i}return t}},"Total Members":{callback:e=>(total="FAMILY"==e.affordable_care_act.coverage_type?2:1,total+=e.dependents.length,total)},Members:{callback:e=>(members="FAMILY"==e.affordable_care_act.coverage_type?`${e.espouse_information.first_name} ${e.espouse_information.middle_name} ${e.espouse_information.last_name}`:"",members.length>0&&parseInt(e.espouse_information.added)?members+=" (Apply)":members.length>0&&!parseInt(e.espouse_information.added)&&(members+=" (No Apply)"),e.dependents.length>0&&e.dependents.forEach(e=>{member_application=parseInt(e.added)?"(Apply)":"(No Apply)",members+=`\n${e.first_name} ${e.last_name} ${member_application}`}),members)}}},header:[{text:"ID",align:"start",value:"ID"},{text:"Date",align:"start",value:"published_at"},{text:"Applicant",align:"start",value:"applicant"},{text:"Status",value:"status"},{text:"Actions",value:"actions",align:"center",sortable:!1}],items:[],editedItem:{},editedIndex:-1},modifications:{expanded:[],header:[{text:"Date",align:"center",value:"published_at"},{text:"Status",align:"center",value:"status"}],items:[],content:""},attachments:{dialog:!1,header:[{text:"Date",align:"center",value:"published_at"},{text:"Name",align:"center",value:"post_title"},{text:"Status",align:"center",value:"status"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{post_title:""},editedIndex:-1},manager_attachments:{header:[{text:"Date",align:"center",value:"published_at"},{text:"Name",align:"center",value:"post_title"},{text:"Action",align:"center",value:"actions"}],items:[]},information_requests:{dialog:!1,delete_dialog:!1,header:[{text:"Date",align:"center",value:"published_at"},{text:"Information",align:"center",value:"post_title"},{text:"Content",align:"center",value:"post_content"},{text:"Status",align:"center",value:"status"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{post_title:"",post_content:""},editedIndex:-1},action_history:{dialog:!1,details_dialog:!1,loading:!1,headers:[{text:"Date",align:"center",value:"created_at"},{text:"Description",align:"center",value:"action_message"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{},detail_items:[]}},created(){null===this.quote_id?this.initialize():this.initializeAndPrevisualize(),initNotifications(this),setInterval(initNotifications,3e4,this)},mounted(){},methods:{logout(){var e=this,t=api_url+"ra_elite_usa_insurance_logout";e.logout_loading=!0,e.$http.get(t).then(t=>{e.logout_loading=!1,window.location=t.body.redirect_url},t=>{e.logout_loading=!1})},initialize(){var e=this,t=api_url+"ra_elite_usa_insurance_get_my_quote_forms";e.table_loading=!0,e.$http.get(t).then(t=>{if(e.table_loading=!1,t.body.length>0){var a=[];t.body.forEach(e=>{var t=e;t.published_at=moment(t.affordable_care_act.date).format("DD/MM/YYYY, h:mm:ss a"),t.applicant=t.personal_information.first_name+" "+t.personal_information.middle_name+" "+t.personal_information.last_name,a.push(t)}),e.quotes.items=a}},t=>{e.table_loading=!1})},initializeAndPrevisualize(){var e=this,t=api_url+"ra_elite_usa_insurance_get_my_quote_forms";e.table_loading=!0,e.$http.get(t).then(t=>{if(e.table_loading=!1,t.body.length>0){var a=[],i={};t.body.forEach(e=>{var t=e;t.published_at=t.affordable_care_act.date,t.applicant=t.personal_information.first_name+" "+t.personal_information.middle_name+" "+t.personal_information.last_name,a.push(t)}),e.quotes.items=a;i=e.quotes.items.filter(t=>parseInt(t.ID)==parseInt(e.quote_id));i.length>0?(e.showItem(i[0]),e.getModificationRequests(),e.getInformationRequests(),e.getAttachmentsRequests(),e.getManagerAttachments()):(e.barAlert=!0,e.barMessage="The quote requested is not available")}},t=>{e.table_loading=!1})},getModificationRequests(){var e=this;e.modifications.items=[];var t=e.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_modification_requests",i=(e.quotes.editedIndex,{post_parent:t.ID});e.requests_table_loading=!0,e.$http.post(a,i).then(t=>{e.requests_table_loading=!1;var a=[];t.body.length>0&&(a=t.body),e.modifications.items=a},e=>{})},getAttachmentsRequests(){var e=this;e.attachments.items=[];var t=e.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_attachment_requests",i=(e.quotes.editedIndex,{post_parent:t.ID});e.attachments_table_loading=!0,e.$http.post(a,i).then(t=>{e.attachments_table_loading=!1;var a=[];t.body.length>0&&(a=t.body),e.attachments.items=a},e=>{})},getManagerAttachments(){var e=this;e.manager_attachments.items=[];var t=e.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_manager_attachments",i={post_parent:t.ID};e.manager_attachments_table_loading=!0,e.$http.post(a,i).then(t=>{e.manager_attachments_table_loading=!1;var a=[];t.body.length>0&&(a=t.body),e.manager_attachments.items=a},e=>{})},getInformationRequests(){var e=this;e.information_requests.items=[];var t=e.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_information_requests",i={post_parent:t.ID};e.information_requests_table_loading=!0,e.$http.post(a,i).then(t=>{e.information_requests_table_loading=!1;var a=[];t.body.length>0&&(a=t.body),e.information_requests.items=a},e=>{})},getActionsHistory(e){var t=this;t.action_history.items=[];var a=api_url+"ra_elite_usa_insurance_get_quote_action_history",i={ID:e.ID};t.action_history.loading=!0,t.$http.post(a,i).then(e=>{t.action_history.loading=!1;var a=[];e.body.length>0&&e.body.forEach((e,t)=>{e.extra_info=JSON.parse(e.extra_info),"Quote's creation"!=e.action_message&&(e.created_at=usesGMT?moment.utc(moment(e.created_at).format("YYYY-MM-DD, h:mm:ss")).local():e.created_at),"quote_doc_r"==e.extra_info.post_type&&e.extra_info.meta_input.attachment_url.includes("[")&&(e.extra_info.meta_input.attachment_url=JSON.parse(e.extra_info.meta_input.attachment_url))}),a=e.body,t.action_history.items=a},e=>{})},showActionDetails(e){var t=this,a=t.action_history;a.editedItem=Object.assign({},e),a.detail_items=[];var i=a.items.filter(e=>e.post_parent==a.editedItem.post_parent);a.detail_items=i,a.details_dialog=!0},checkStatusColor(e){switch(e){case"Processing":return"warning";case"Approved":return"green";case"In tray":return"primary"}},showItem(e){this.quotes.editedIndex=this.quotes.items.indexOf(e),this.quotes.editedItem=Object.assign({},e),this.view_dialog=!0},editItem(e){this.quotes.editedIndex=this.quotes.items.indexOf(e),this.quotes.editedItem=Object.assign({},e),this.edit_dialog=!0},editAttachmentItem(e){this.attachments.editedIndex=this.attachments.items.indexOf(e),this.attachments.editedItem=Object.assign({},e),this.attachments.dialog=!0},editInformationRequestItem(e){this.information_requests.editedIndex=this.information_requests.items.indexOf(e),this.information_requests.editedItem=Object.assign({},e),this.information_requests.dialog=!0},closeView(){this.view_dialog=!1,this.$nextTick(()=>{this.quotes.editedItem=Object.assign({},{}),this.quotes.editedIndex=-1})},closeEdit(){this.edit_dialog=!1,this.$nextTick(()=>{this.modifications.content=""})},closeAttachment(){this.attachments.dialog=!1,this.$nextTick(()=>{this.attachments.editedItem=Object.assign({},{file:""}),this.attachments.editedIndex=-1})},closeInformationRequest(){this.information_requests.dialog=!1,this.$nextTick(()=>{this.information_requests.editedItem=Object.assign({},{}),this.information_requests.editedIndex=-1})},sendModificationRequest(){var e=this,t=e.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_save_quote_modification_request",i=(e.quotes.editedIndex,{post_parent:t.ID,agent:t.affordable_care_act.agent_name,post_date:moment().format("YYYY-MM-DD"),post_date_name:moment().format("DD/MM/YYYY"),post_content:e.modifications.content});e.quote_loading=!0,e.$http.post(a,i).then(t=>{e.quote_loading=!1,e.barAlert=!0,t.body.hasOwnProperty("message")?(e.barMessage=t.body.message,"success"==t.body.status&&(i.status=0,i.ID=t.body.data,e.modifications.items.push(i),e.modifications.content="",e.closeEdit())):(e.alert_type="error",e.barMessage="There was an error")},t=>{e.quote_loading=!1,e.barAlert=!0,e.barMessage="There was an error, it can't be possible process the information sent"})},uploadAttachment(){var e=this,t=e.attachments.editedItem,a=api_url+"ra_elite_usa_insurance_upload_quote_attachment_requested",i=e.attachments.editedIndex,n=new FormData;n.append("ID",t.ID),n.append("post_title",t.post_title),n.append("post_author",t.post_author),n.append("agent",e.quotes.editedItem.affordable_care_act.agent_name),""!=t.attachment_id&&n.append("attachment_id",t.attachment_id),t.doc.forEach((e,t)=>{n.append("attachment["+t+"]",e)}),e.attachment_loading=!0,e.$http.post(a,n,{progress(t){t.lengthComputable&&(e.percent_loading_active=!0,e.percent_loading=t.loaded/t.total*100)}}).then(a=>{e.attachment_loading=!1,e.barAlert=!0,e.percent_loading_active=!1,e.percent_loading_active=0,a.body.hasOwnProperty("message")?(e.barMessage=a.body.message,"success"==a.body.status&&(t.status=1,""==t.attachment_id&&(t.attachment_id=a.body.data.attachment_id),t.attachment_url=a.body.data.attachment_url,Object.assign(e.attachments.items[i],t),e.attachments.dialog=!1)):(e.alert_type="error",e.barMessage="There was an error")},t=>{e.attachment_loading=!1,e.barAlert=!0,e.barMessage="There was an error, it can't be possible process the information sent"})},uploadInformationRequest(){var e=this,t=e.information_requests.editedItem;t.agent=e.quotes.editedItem.affordable_care_act.agent_name;var a=api_url+"ra_elite_usa_insurance_upload_quote_information_requested",i=e.information_requests.editedIndex;e.information_requests_loading=!0,e.$http.post(a,t).then(a=>{e.information_requests_loading=!1,e.barAlert=!0,a.body.hasOwnProperty("message")?(e.barMessage=a.body.message,"success"==a.body.status&&(t.status=2,Object.assign(e.information_requests.items[i],t),e.information_requests.dialog=!1)):(e.alert_type="error",e.barMessage="There was an error")},t=>{e.attachment_loading=!1,e.barAlert=!0,e.barMessage="There was an error, it can't be possible process the information sent"})},getAge(e){var t=this,a=moment().diff(t.quotes.editedItem[e].birthdate,"years");return t.quotes.editedItem[e].age=a,a},currencyFormat(e,t){if(typeof e!==String){var a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),i=a.format(e);return t||(i=i.split("$")[1]),"$NaN"==i||NaN===i?t?"$"+e:e:i}return e},numberFormat:e=>Number(e.replace(/[^0-9.-]+/g,"")),getFormatDate:e=>""==e?"":moment(e).format("MM/DD/YYYY"),getFormatDateShort:e=>""==e?"":moment(e).format("MM/YYYY"),getFormatDateExtended:e=>""==e?"":moment(e).format("MM/DD/YYYY, h:mm:ss a"),generateQuotePDF(){var e=this,t=e.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_generate_quote_pdf";e.pdf_loading=!0,e.$http.post(a,t).then(t=>{if("success"==t.body.status){e.pdf_loading=!1;var a=t.body,i=document.createElement("a");i.href=a.content,document.body.append(i),i.download=a.applicant+".pdf",i.click(),i.remove()}},e=>{})},calcTotalIncome(){var e=this,t=e.quotes.editedItem,a="string"==typeof t.employment_information.income?e.numberFormat(t.employment_information.income):parseInt(t.employment_information.income),i="string"==typeof t.espouse_employment_information.income?e.numberFormat(t.espouse_employment_information.income):parseInt(t.espouse_employment_information.income),n=a+i;return t.personal_information.total_income=e.currencyFormat(n,!0),t.personal_information.total_income},countStatus(e){if(""==e)return this.quotes.items.length;var t=this.quotes.items.filter((t,a)=>t.status==e);return t.length},filterQuotes(e){var t=this,a=t.quotes.items.filter(t=>parseInt(t.ID)==parseInt(e));a.length>0?(t.showItem(a[0]),t.getModificationRequests(),t.getInformationRequests(),t.getAttachmentsRequests(),t.getManagerAttachments()):(t.barAlert=!0,t.barMessage="The quote requested is not available")}}});
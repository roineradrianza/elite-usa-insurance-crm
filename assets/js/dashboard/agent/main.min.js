const vuetify=new Vuetify(vuetify_opts),api_url=ra_elite_usa_insurance_ajaxurl;Vue.component("downloadExcel",JsonExcel);let vm=new Vue({vuetify:vuetify,el:"#ra-elite-usa-insurance-container",data:{selectedItem:0,barAlert:!1,barTimeout:6e3,percent_loading_active:!1,percent_loading:!1,pdf_loading:!1,logout_loading:!1,barMessage:"",quote_id:url_params.get("quotation_id"),notifications_loading:!1,quote_loading:!1,table_loading:!1,requests_table_loading:!1,attachments_table_loading:!1,manager_attachments_table_loading:!1,manager_attachment_loading:!1,agent_attachments_table_loading:!1,agent_attachment_loading:!1,information_requests_table_loading:!1,information_requests_loading:!1,attachment_loading:!1,view_dialog:!1,edit_dialog:!1,alert:!1,alert_type:"",alert_message:"",request_edit_form_valid:!1,routes:routes,notifications:[],rules:{required:[t=>!!t||"This field is required"]},quotes:{modification_content:"",search:"",excel:{header:{"Full Name":{field:"personal_information",callback:t=>`${t.first_name} ${t.middle_name} ${t.last_name}`},Birthdate:{field:"personal_information",callback:t=>moment(t.birthdate).format("MM/DD/YYYY")},Telephone:{field:"personal_information.telephone",callback:t=>`Tel:${t}`},Email:{field:"personal_information.email"},Agent:{field:"agent"},Year:{field:"year"},"Company / Plan":{field:"affordable_care_act.company_plan"},Income:{field:"personal_information.total_income",callback(t){let e=t;if(typeof e!==String){var a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),n=a.format(e);return"$NaN"==n||NaN===n?e:n}return e}},"Total Members":{callback:t=>(total="FAMILY"==t.affordable_care_act.coverage_type?2:1,total+=t.dependents.length,total)},Members:{callback:t=>(members="FAMILY"==t.affordable_care_act.coverage_type?`${t.espouse_information.first_name} ${t.espouse_information.middle_name} ${t.espouse_information.last_name}`:"",members.length>0&&parseInt(t.espouse_information.added)?members+=" (Apply)":members.length>0&&!parseInt(t.espouse_information.added)&&(members+=" (No Apply)"),t.dependents.length>0&&t.dependents.forEach(t=>{member_application=parseInt(t.added)?"(Apply)":"(No Apply)",members+=`\n${t.first_name} ${t.last_name} ${member_application}`}),members)}}},header:[{text:"ID",align:"start",value:"ID"},{text:"Date",align:"start",value:"published_at"},{text:"Applicant",align:"start",value:"applicant"},{text:"Year",value:"year"},{text:"Type",value:"type"},{text:"Status",value:"status"},{text:"Actions",value:"actions",align:"center",sortable:!1}],items:[],editedItem:{},editedIndex:-1},modifications:{expanded:[],header:[{text:"Date",align:"center",value:"published_at"},{text:"Status",align:"center",value:"status"}],items:[],content:""},attachments:{dialog:!1,header:[{text:"Date",align:"center",value:"published_at"},{text:"Name",align:"center",value:"post_title"},{text:"Status",align:"center",value:"status"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{post_title:""},editedIndex:-1},manager_attachments:{header:[{text:"Date",align:"center",value:"published_at"},{text:"Name",align:"center",value:"post_title"},{text:"Action",align:"center",value:"actions"}],items:[]},agent_attachments:{dialog:!1,delete_dialog:!1,header:[{text:"Date",align:"center",value:"published_at"},{text:"Name",align:"center",value:"post_title"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{post_title:""},editedIndex:-1},information_requests:{dialog:!1,delete_dialog:!1,header:[{text:"Date",align:"center",value:"published_at"},{text:"Information",align:"center",value:"post_title"},{text:"Content",align:"center",value:"post_content"},{text:"Status",align:"center",value:"status"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{post_title:"",post_content:""},editedIndex:-1},action_history:{dialog:!1,details_dialog:!1,loading:!1,headers:[{text:"Date",align:"center",value:"created_at"},{text:"Description",align:"center",value:"action_message"},{text:"Action",align:"center",value:"actions"}],items:[],editedItem:{},detail_items:[]}},created(){null===this.quote_id?this.initialize():this.initializeAndPrevisualize(),initNotifications(this),setInterval(initNotifications,3e4,this)},mounted(){},computed:{formAgentAttachmentTitle(){return-1===this.agent_attachments.editedIndex?"New Document Attachment":"Edit Document Attachment"}},methods:{logout(){var t=this,e=api_url+"ra_elite_usa_insurance_logout";t.logout_loading=!0,t.$http.get(e).then(e=>{t.logout_loading=!1,window.location=e.body.redirect_url},e=>{t.logout_loading=!1})},initialize(){var t=this,e=api_url+"ra_elite_usa_insurance_get_my_quote_forms";t.table_loading=!0,t.$http.get(e).then(e=>{if(t.table_loading=!1,e.body.length>0){var a=[];e.body.forEach(t=>{var e=t;e.published_at=moment(e.affordable_care_act.date).format("DD/MM/YYYY, h:mm:ss a"),e.applicant=e.personal_information.first_name+" "+e.personal_information.middle_name+" "+e.personal_information.last_name,e.type=e.post_parent<=0?"First-Time":"Renewal",e.personal_information.same_address=e.personal_information.hasOwnProperty("same_address")?e.personal_information.same_address:1,e.affordable_care_act.hasOwnProperty("renewal_date")?e.year=moment(e.affordable_care_act.renewal_date).format("YYYY"):e.year=moment(e.affordable_care_act.effectiveness_date).isSameOrAfter(moment(e.affordable_care_act.date))?moment(e.affordable_care_act.effectiveness_date).format("YYYY"):moment(e.affordable_care_act.date).format("YYYY"),a.push(e)}),t.quotes.items=a}},e=>{t.table_loading=!1})},initializeAndPrevisualize(){var t=this,e=api_url+"ra_elite_usa_insurance_get_my_quote_forms";t.table_loading=!0,t.$http.get(e).then(e=>{if(t.table_loading=!1,e.body.length>0){var a=[],n={};e.body.forEach(t=>{var e=t;e.published_at=e.affordable_care_act.date,e.applicant=e.personal_information.first_name+" "+e.personal_information.middle_name+" "+e.personal_information.last_name,e.type=e.post_parent<=0?"First-Time":"Renewal",e.year=moment(e.affordable_care_act.date).format("YYYY"),a.push(e)}),t.quotes.items=a;n=t.quotes.items.filter(e=>parseInt(e.ID)==parseInt(t.quote_id));n.length>0?(t.showItem(n[0]),t.getModificationRequests(),t.getInformationRequests(),t.getAttachmentsRequests(),t.getManagerAttachments(),t.getAgentAttachments()):(t.barAlert=!0,t.barMessage="The quote requested is not available")}},e=>{t.table_loading=!1})},getModificationRequests(){var t=this;t.modifications.items=[];var e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_modification_requests",n=(t.quotes.editedIndex,{post_parent:e.ID});t.requests_table_loading=!0,t.$http.post(a,n).then(e=>{t.requests_table_loading=!1;var a=[];e.body.length>0&&(a=e.body),t.modifications.items=a},t=>{})},getAttachmentsRequests(){var t=this;t.attachments.items=[];var e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_attachment_requests",n=(t.quotes.editedIndex,{post_parent:e.ID});t.attachments_table_loading=!0,t.$http.post(a,n).then(e=>{t.attachments_table_loading=!1;var a=[];e.body.length>0&&(a=e.body),t.attachments.items=a},t=>{})},getManagerAttachments(){var t=this;t.manager_attachments.items=[];var e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_manager_attachments",n={post_parent:e.ID};t.manager_attachments_table_loading=!0,t.$http.post(a,n).then(e=>{t.manager_attachments_table_loading=!1;var a=[];e.body.length>0&&(a=e.body),t.manager_attachments.items=a},t=>{})},getAgentAttachments(){var t=this;t.agent_attachments.items=[];var e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_agent_attachments",n={post_parent:e.ID};t.agent_attachments_table_loading=!0,t.$http.post(a,n).then(e=>{t.agent_attachments_table_loading=!1;var a=[];e.body.length>0&&(a=e.body),t.agent_attachments.items=a},t=>{})},getInformationRequests(){var t=this;t.information_requests.items=[];var e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_get_quote_information_requests",n={post_parent:e.ID};t.information_requests_table_loading=!0,t.$http.post(a,n).then(e=>{t.information_requests_table_loading=!1;var a=[];e.body.length>0&&(a=e.body),t.information_requests.items=a},t=>{})},getActionsHistory(t){var e=this;e.action_history.items=[];var a=api_url+"ra_elite_usa_insurance_get_quote_action_history",n={ID:t.ID};e.action_history.loading=!0,e.$http.post(a,n).then(t=>{e.action_history.loading=!1;var a=[];t.body.length>0&&t.body.forEach((t,e)=>{t.extra_info=JSON.parse(t.extra_info),"Quote's creation"!=t.action_message&&(t.created_at=usesGMT?moment.utc(moment(t.created_at).format("YYYY-MM-DD, h:mm:ss")).local():t.created_at),"quote_doc_r"==t.extra_info.post_type&&t.extra_info.meta_input.attachment_url.includes("[")&&(t.extra_info.meta_input.attachment_url=JSON.parse(t.extra_info.meta_input.attachment_url))}),a=t.body,e.action_history.items=a},t=>{})},showActionDetails(t){var e=this,a=e.action_history;a.editedItem=Object.assign({},t),a.detail_items=[];var n=a.items.filter(t=>t.post_parent==a.editedItem.post_parent);a.detail_items=n,a.details_dialog=!0},checkStatusColor(t){switch(t){case"Processing":return"warning";case"Approved":return"green";case"In tray":return"primary";default:return"grey darken-2"}},showItem(t){this.quotes.editedIndex=this.quotes.items.indexOf(t),this.quotes.editedItem=Object.assign({},t),this.view_dialog=!0},editItem(t){this.quotes.editedIndex=this.quotes.items.indexOf(t),this.quotes.editedItem=Object.assign({},t),this.edit_dialog=!0},editAttachmentItem(t){this.attachments.editedIndex=this.attachments.items.indexOf(t),this.attachments.editedItem=Object.assign({},t),this.attachments.dialog=!0},editAgentAttachmentItem(t){this.agent_attachments.editedIndex=this.agent_attachments.items.indexOf(t),this.agent_attachments.editedItem=Object.assign({},t),this.agent_attachments.dialog=!0},editInformationRequestItem(t){this.information_requests.editedIndex=this.information_requests.items.indexOf(t),this.information_requests.editedItem=Object.assign({},t),this.information_requests.dialog=!0},deleteAgentAttachmentItem(t){this.agent_attachments.editedIndex=this.agent_attachments.items.indexOf(t),this.agent_attachments.editedItem=Object.assign({},t),this.agent_attachments.delete_dialog=!0},closeView(){this.view_dialog=!1,this.$nextTick(()=>{this.quotes.editedItem=Object.assign({},{}),this.quotes.editedIndex=-1})},closeEdit(){this.edit_dialog=!1,this.$nextTick(()=>{this.modifications.content=""})},closeAttachment(){this.attachments.dialog=!1,this.$nextTick(()=>{this.attachments.editedItem=Object.assign({},{file:""}),this.attachments.editedIndex=-1})},closeAgentAttachment(){this.agent_attachments.dialog=!1,this.$nextTick(()=>{this.agent_attachments.editedItem=Object.assign({},{}),this.agent_attachments.editedIndex=-1})},closeAgentAttachmentDelete(){this.agent_attachments.delete_dialog=!1,this.$nextTick(()=>{this.agent_attachments.editedItem=Object.assign({},{}),this.agent_attachments.editedIndex=-1})},closeInformationRequest(){this.information_requests.dialog=!1,this.$nextTick(()=>{this.information_requests.editedItem=Object.assign({},{}),this.information_requests.editedIndex=-1})},sendModificationRequest(){var t=this,e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_save_quote_modification_request",n=(t.quotes.editedIndex,{post_parent:e.ID,agent:e.affordable_care_act.agent_name,post_date:moment().format("YYYY-MM-DD"),post_date_name:moment().format("DD/MM/YYYY"),post_content:t.modifications.content});t.quote_loading=!0,t.$http.post(a,n).then(e=>{t.quote_loading=!1,t.barAlert=!0,e.body.hasOwnProperty("message")?(t.barMessage=e.body.message,"success"==e.body.status&&(n.status=0,n.ID=e.body.data,t.modifications.items.push(n),t.modifications.content="",t.closeEdit())):(t.alert_type="error",t.barMessage="There was an error")},e=>{t.quote_loading=!1,t.barAlert=!0,t.barMessage="There was an error, it can't be possible process the information sent"})},uploadAttachment(){var t=this,e=t.attachments.editedItem,a=api_url+"ra_elite_usa_insurance_upload_quote_attachment_requested",n=t.attachments.editedIndex,i=new FormData;i.append("ID",e.ID),i.append("post_title",e.post_title),i.append("post_author",e.post_author),i.append("agent",t.quotes.editedItem.affordable_care_act.agent_name),""!=e.attachment_id&&i.append("attachment_id",e.attachment_id),e.doc.forEach((t,e)=>{i.append("attachment["+e+"]",t)}),t.attachment_loading=!0,t.$http.post(a,i,{progress(e){e.lengthComputable&&(t.percent_loading_active=!0,t.percent_loading=e.loaded/e.total*100)}}).then(a=>{t.attachment_loading=!1,t.barAlert=!0,t.percent_loading_active=!1,t.percent_loading_active=0,a.body.hasOwnProperty("message")?(t.barMessage=a.body.message,"success"==a.body.status&&(e.status=1,""==e.attachment_id&&(e.attachment_id=a.body.data.attachment_id),e.attachment_url=a.body.data.attachment_url,Object.assign(t.attachments.items[n],e),t.attachments.dialog=!1)):(t.alert_type="error",t.barMessage="There was an error")},e=>{t.attachment_loading=!1,t.barAlert=!0,t.barMessage="There was an error, it can't be possible process the information sent"})},uploadInformationRequest(){var t=this,e=t.information_requests.editedItem;e.agent=t.quotes.editedItem.affordable_care_act.agent_name;var a=api_url+"ra_elite_usa_insurance_upload_quote_information_requested",n=t.information_requests.editedIndex;t.information_requests_loading=!0,t.$http.post(a,e).then(a=>{t.information_requests_loading=!1,t.barAlert=!0,a.body.hasOwnProperty("message")?(t.barMessage=a.body.message,"success"==a.body.status&&(e.status=2,Object.assign(t.information_requests.items[n],e),t.information_requests.dialog=!1)):(t.alert_type="error",t.barMessage="There was an error")},e=>{t.attachment_loading=!1,t.barAlert=!0,t.barMessage="There was an error, it can't be possible process the information sent"})},saveAgentAttachment(){var t=this,e=t.agent_attachments.editedItem,a=api_url+"ra_elite_usa_insurance_save_quote_agent_attachment",n=t.agent_attachments.editedIndex,i=new FormData;e.hasOwnProperty("ID")&&null!=e.ID&&i.append("ID",e.ID),i.append("post_parent",t.quotes.editedItem.ID),i.append("agent",t.quotes.editedItem.post_author),i.append("post_title",e.post_title),null==e.doc&&""==e.doc||i.append("attachment",e.doc),e.hasOwnProperty("post_author")&&""!=e.post_author&&i.append("post_author",e.post_author),e.hasOwnProperty("attachment_id")&&""!=e.attachment_id&&i.append("attachment_id",e.attachment_id),e.hasOwnProperty("attachment_url")&&""!=e.attachment_url&&i.append("attachment_url",e.attachment_url),t.manager_attachment_loading=!0,t.$http.post(a,i,{progress(e){e.lengthComputable&&(t.percent_loading_active=!0,t.percent_loading=e.loaded/e.total*100)}}).then(a=>{t.manager_attachment_loading=!1,t.barAlert=!0,t.percent_loading_active=!1,t.percent_loading_active=0,a.body.hasOwnProperty("message")?(t.barMessage=a.body.message,"success"==a.body.status&&(e.hasOwnProperty("attachment_id")&&""!=e.attachment_id||(e.ID=a.body.data.ID,e.attachment_id=a.body.data.attachment_id,e.published_at=moment()),e.attachment_url=a.body.data.hasOwnProperty("attachment_url")?a.body.data.attachment_url:e.attachment_url,-1===n?t.agent_attachments.items.push(e):Object.assign(t.agent_attachments.items[n],e),t.agent_attachments.dialog=!1)):(t.alert_type="error",t.barMessage="There was an error")},e=>{t.manager_attachment_loading=!1,t.barAlert=!0,t.barMessage="There was an error, it can't be possible process the information sent"})},deleteAgentAttachment(){var t=this,e=t.agent_attachments.editedItem,a=api_url+"ra_elite_usa_insurance_delete_quote_manager_attachment",n=t.agent_attachments.editedIndex;t.$http.post(a,{ID:e.ID}).then(e=>{t.barAlert=!0,t.agent_attachments.delete_dialog=!1,e.body.hasOwnProperty("message")?(t.barMessage=e.body.message,"success"==e.body.status&&t.agent_attachments.items.splice(n,1)):(t.alert_type="error",t.barMessage="There was an error")},e=>{t.agent_attachments.delete_dialog=!1,t.barAlert=!0,t.barMessage="There was an error, it can't be possible process the information sent"})},getAge(t){var e=this,a=moment().diff(e.quotes.editedItem[t].birthdate,"years");return e.quotes.editedItem[t].age=a,a},currencyFormat(t,e){if(typeof t!==String){var a=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),n=a.format(t);return e||(n=n.split("$")[1]),"$NaN"==n||NaN===n?e?"$"+t:t:n}return t},numberFormat:t=>Number(t.replace(/[^0-9.-]+/g,"")),getFormatDate:t=>""==t?"":moment(t).format("MM/DD/YYYY"),getFormatDateShort:t=>""==t?"":moment(t).format("MM/YYYY"),getFormatDateExtended:t=>""==t?"":moment(t).format("MM/DD/YYYY, h:mm:ss a"),generateQuotePDF(){var t=this,e=t.quotes.editedItem,a=api_url+"ra_elite_usa_insurance_generate_quote_pdf";t.pdf_loading=!0,t.$http.post(a,e).then(e=>{if("success"==e.body.status){t.pdf_loading=!1;var a=e.body,n=document.createElement("a");n.href=a.content,document.body.append(n),n.download=a.applicant+".pdf",n.click(),n.remove()}},t=>{})},calcTotalIncome(){var t=this,e=t.quotes.editedItem,a="string"==typeof e.employment_information.income?t.numberFormat(e.employment_information.income):parseInt(e.employment_information.income),n="string"==typeof e.espouse_employment_information.income?t.numberFormat(e.espouse_employment_information.income):parseInt(e.espouse_employment_information.income),i=a+n;return e.personal_information.total_income=t.currencyFormat(i,!0),e.personal_information.total_income},countStatus(t){if(""==t)return this.quotes.items.length;var e=this.quotes.items.filter((e,a)=>e.status==t);return e.length},filterQuotes(t){var e=this,a=e.quotes.items.filter(e=>parseInt(e.ID)==parseInt(t));a.length>0?(e.showItem(a[0]),e.getModificationRequests(),e.getInformationRequests(),e.getAttachmentsRequests(),e.getManagerAttachments(),e.getAgentAttachments()):(e.barAlert=!0,e.barMessage="The quote requested is not available")}}});